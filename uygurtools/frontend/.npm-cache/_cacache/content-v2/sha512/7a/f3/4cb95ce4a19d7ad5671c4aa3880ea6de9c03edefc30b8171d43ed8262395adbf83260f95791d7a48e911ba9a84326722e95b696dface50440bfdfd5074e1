{"_attachments":{},"_id":"@microsoft/fetch-event-source","_rev":"305085-61f1d4e0ffbd598ed28d796a","author":{"name":"Microsoft"},"description":"A better API for making Event Source requests, with all the features of fetch()","dist-tags":{"alpha":"2.0.0-alpha.2","latest":"2.0.1"},"license":"MIT","maintainers":[{"name":"microsoft1es","email":"npmjs@microsoft.com"},{"name":"bobbybhamra","email":"bobbybhamra-ms@outlook.com"},{"name":"vincenzocaruso","email":"vicaruso@microsoft.com"},{"name":"vishwam","email":"vishwam@live.com"},{"name":"patobeltran","email":"pbelsal@gmail.com"}],"name":"@microsoft/fetch-event-source","readme":"# Fetch Event Source\nThis package provides a better API for making [Event Source requests](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events) - also known as server-sent events - with all the features available in the [Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API).\n\nThe [default browser EventSource API](https://developer.mozilla.org/en-US/docs/Web/API/EventSource) imposes several restrictions on the type of request you're allowed to make: the [only parameters](https://developer.mozilla.org/en-US/docs/Web/API/EventSource/EventSource#Parameters) you're allowed to pass in are the `url` and `withCredentials`, so:\n* You cannot pass in a request body: you have to encode all the information necessary to execute the request inside the URL, which is [limited to 2000 characters](https://stackoverflow.com/questions/417142) in most browsers.\n* You cannot pass in custom request headers\n* You can only make GET requests - there is no way to specify another method.\n* If the connection is cut, you don't have any control over the retry strategy: the browser will silently retry for you a few times and then stop, which is not good enough for any sort of robust application.\n\nThis library provides an alternate interface for consuming server-sent events, based on the Fetch API. It is fully compatible with the [Event Stream format](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events#Event_stream_format), so if you already have a server emitting these events, you can consume it just like before. However, you now have greater control over the request and response so:\n\n* You can use any request method/headers/body, plus all the other functionality exposed by fetch(). You can even provide an alternate fetch() implementation, if the default browser implementation doesn't work for you.\n* You have access to the response object if you want to do some custom validation/processing before  parsing the event source. This is useful in case you have API gateways (like nginx) in front of your application server: if the gateway returns an error, you might want to handle it correctly.\n* If the connection gets cut or an error occurs, you have full control over the retry strategy.\n\nIn addition, this library also plugs into the browser's [Page Visibility API](https://developer.mozilla.org/en-US/docs/Web/API/Page_Visibility_API) so the connection closes if the document is hidden (e.g., the user minimizes the window), and automatically retries with the last event ID when it becomes visible again. This reduces the load on your server by not having open connections unnecessarily (but you can opt out of this behavior if you want.)\n\n# Install\n```sh\nnpm install @microsoft/fetch-event-source\n```\n\n# Usage\n```ts\n// BEFORE:\nconst sse = new EventSource('/api/sse');\nsse.onmessage = (ev) => {\n    console.log(ev.data);\n};\n\n// AFTER:\nimport { fetchEventSource } from '@microsoft/fetch-event-source';\n\nawait fetchEventSource('/api/sse', {\n    onmessage(ev) {\n        console.log(ev.data);\n    }\n});\n```\n\nYou can pass in all the [other parameters](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters) exposed by the default fetch API, for example:\n```ts\nconst ctrl = new AbortController();\nfetchEventSource('/api/sse', {\n    method: 'POST',\n    headers: {\n        'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n        foo: 'bar'\n    }),\n    signal: ctrl.signal,\n});\n```\n\nYou can add better error handling, for example:\n```ts\nclass RetriableError extends Error { }\nclass FatalError extends Error { }\n\nfetchEventSource('/api/sse', {\n    async onopen(response) {\n        if (response.ok && response.headers.get('content-type') === EventStreamContentType) {\n            return; // everything's good\n        } else if (response.status >= 400 && response.status < 500 && response.status !== 429) {\n            // client-side errors are usually non-retriable:\n            throw new FatalError();\n        } else {\n            throw new RetriableError();\n        }\n    },\n    onmessage(msg) {\n        // if the server emits an error message, throw an exception\n        // so it gets handled by the onerror callback below:\n        if (msg.event === 'FatalError') {\n            throw new FatalError(msg.data);\n        }\n    },\n    onclose() {\n        // if the server closes the connection unexpectedly, retry:\n        throw new RetriableError();\n    },\n    onerror(err) {\n        if (err instanceof FatalError) {\n            throw err; // rethrow to stop the operation\n        } else {\n            // do nothing to automatically retry. You can also\n            // return a specific retry interval here.\n        }\n    }\n});\n```\n\n# Compatibility\nThis library is written in typescript and targets ES2017 features supported by all evergreen browsers (Chrome, Firefox, Safari, Edge.) You might need to [polyfill TextDecoder](https://www.npmjs.com/package/fast-text-encoding) for old Edge (versions < 79), though:\n```js\nrequire('fast-text-encoding');\n```\n\n# Contributing\n\nThis project welcomes contributions and suggestions.  Most contributions require you to agree to a\nContributor License Agreement (CLA) declaring that you have the right to, and actually do, grant us\nthe rights to use your contribution. For details, visit https://cla.opensource.microsoft.com.\n\nWhen you submit a pull request, a CLA bot will automatically determine whether you need to provide\na CLA and decorate the PR appropriately (e.g., status check, comment). Simply follow the instructions\nprovided by the bot. You will only need to do this once across all repos using our CLA.\n\nThis project has adopted the [Microsoft Open Source Code of Conduct](https://opensource.microsoft.com/codeofconduct/).\nFor more information see the [Code of Conduct FAQ](https://opensource.microsoft.com/codeofconduct/faq/) or\ncontact [opencode@microsoft.com](mailto:opencode@microsoft.com) with any additional questions or comments.\n","time":{"created":"2022-01-26T23:10:24.281Z","modified":"2023-11-15T16:36:55.661Z","2.0.1":"2021-04-25T18:54:56.287Z","2.0.0":"2020-12-25T23:44:28.109Z","2.0.0-alpha.2":"2020-12-22T22:44:48.017Z","2.0.0-alpha.1":"2020-12-22T21:38:41.540Z","1.0.2":"2020-11-27T20:51:07.471Z","1.0.1":"2020-11-18T19:48:21.907Z","1.0.0":"2020-08-17T17:00:02.945Z"},"versions":{"2.0.1":{"name":"@microsoft/fetch-event-source","version":"2.0.1","description":"A better API for making Event Source requests, with all the features of fetch()","homepage":"https://github.com/Azure/fetch-event-source#readme","repository":{"type":"git","url":"git+https://github.com/Azure/fetch-event-source.git"},"bugs":{"url":"https://github.com/Azure/fetch-event-source/issues"},"author":{"name":"Microsoft"},"license":"MIT","main":"lib/cjs/index.js","module":"lib/esm/index.js","types":"lib/cjs/index.d.ts","sideEffects":false,"scripts":{"clean":"rimraf ./lib ./coverage","prebuild":"npm run clean","build":"tsc && tsc -p tsconfig.esm.json","test":"nyc jasmine --config=jasmine.json","prepublishOnly":"npm run build && npm run test"},"devDependencies":{"@types/jasmine":"^3.6.9","jasmine":"^3.7.0","nyc":"^15.1.0","rimraf":"^3.0.2","source-map-support":"^0.5.19","typescript":"^4.2.4"},"gitHead":"b9098b7491a625673f07c2a2567c9ef1cc08076b","_id":"@microsoft/fetch-event-source@2.0.1","_nodeVersion":"14.16.0","_npmVersion":"6.14.11","dist":{"shasum":"9ceecc94b49fbaa15666e38ae8587f64acce007d","size":11765,"noattachment":false,"tarball":"https://packages.aliyun.com/604c1a6bf11bae7ca07d6ad3/npm/npm-registry/@microsoft/fetch-event-source/-/fetch-event-source-2.0.1.tgz","integrity":"sha512-W6CLUJ2eBMw3Rec70qrsEW0jOm/3twwJv21mrmj2yORiaVmVYGS4sSS5yUwvQc1ZlDLYGPnClVWmUUMagKNsfA=="},"_npmUser":{"name":"vishwam","email":"vishwam@live.com"},"directories":{},"maintainers":[{"name":"bobbybhamra","email":"bobbybhamra-ms@outlook.com"},{"name":"vincenzocaruso","email":"vicaruso@microsoft.com"},{"name":"vishwam","email":"vishwams@microsoft.com"}],"_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/fetch-event-source_2.0.1_1619376896133_0.753828525273772"},"_hasShrinkwrap":false,"publish_time":1619376896287,"_cnpm_publish_time":1619376896287,"_cnpmcore_publish_time":"2021-12-16T14:41:16.099Z"},"2.0.0":{"name":"@microsoft/fetch-event-source","version":"2.0.0","description":"A better API for making Event Source requests, with all the features of fetch()","homepage":"https://github.com/Azure/fetch-event-source#readme","bugs":{"url":"https://github.com/Azure/fetch-event-source/issues"},"author":{"name":"Microsoft"},"license":"MIT","main":"lib/index.js","types":"lib/index.d.ts","sideEffects":false,"scripts":{"clean":"rimraf ./lib ./coverage","prebuild":"npm run clean","build":"tsc","test":"nyc jasmine --config=jasmine.json","prepublishOnly":"npm run build && npm run test"},"devDependencies":{"@types/jasmine":"^3.5.12","jasmine":"^3.6.1","nyc":"^15.1.0","rimraf":"^3.0.2","source-map-support":"^0.5.19","typescript":"^3.9.7"},"gitHead":"6ff6dd1c45a5b0a174bfc5f50527d7cd585828e7","_id":"@microsoft/fetch-event-source@2.0.0","_nodeVersion":"12.18.3","_npmVersion":"6.14.6","dist":{"shasum":"45eeb214869af73ee3e02841f3618756a7f2254f","size":6998,"noattachment":false,"tarball":"https://packages.aliyun.com/604c1a6bf11bae7ca07d6ad3/npm/npm-registry/@microsoft/fetch-event-source/-/fetch-event-source-2.0.0.tgz","integrity":"sha512-bypT3MhtQItUQRIO+BBlj+BHw2UNQV1FoCmY7Zs1gJCFNhVP/Sc6EmDaUDk9pm+Sh/YfgQxtZUIIBt4b1wU5xw=="},"_npmUser":{"name":"vishwam","email":"vishwam@live.com"},"directories":{},"maintainers":[{"name":"bobbybhamra","email":"bobbybhamra-ms@outlook.com"},{"name":"vincenzocaruso","email":"vicaruso@microsoft.com"},{"name":"vishwam","email":"vishwams@microsoft.com"}],"_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/fetch-event-source_2.0.0_1608939867999_0.5598168323364485"},"_hasShrinkwrap":false,"publish_time":1608939868109,"_cnpm_publish_time":1608939868109,"_cnpmcore_publish_time":"2021-12-16T14:41:16.471Z"},"2.0.0-alpha.2":{"name":"@microsoft/fetch-event-source","version":"2.0.0-alpha.2","description":"A better API for making Event Source requests, with all the features of fetch()","homepage":"https://github.com/Azure/fetch-event-source#readme","bugs":{"url":"https://github.com/Azure/fetch-event-source/issues"},"author":{"name":"Microsoft"},"license":"MIT","main":"lib/index.js","types":"lib/index.d.ts","sideEffects":false,"scripts":{"clean":"rimraf ./lib ./coverage","prebuild":"npm run clean","build":"tsc","test":"nyc jasmine --config=jasmine.json","prepublishOnly":"npm run build && npm run test"},"devDependencies":{"@types/jasmine":"^3.5.12","jasmine":"^3.6.1","nyc":"^15.1.0","rimraf":"^3.0.2","source-map-support":"^0.5.19","typescript":"^3.9.7"},"readmeFilename":"README.md","gitHead":"6ff6dd1c45a5b0a174bfc5f50527d7cd585828e7","_id":"@microsoft/fetch-event-source@2.0.0-alpha.2","_nodeVersion":"12.18.3","_npmVersion":"6.14.6","dist":{"shasum":"d39b69c7a59ebb43a6665edcc379a570f168a87f","size":6574,"noattachment":false,"tarball":"https://packages.aliyun.com/604c1a6bf11bae7ca07d6ad3/npm/npm-registry/@microsoft/fetch-event-source/-/fetch-event-source-2.0.0-alpha.2.tgz","integrity":"sha512-Kt2+P2Zuu+E8Yl66H5od4gfOJa/Cvoq0NBspIq88BmWsCJOOL4UaPkxsL3OGElpPO4uZj8zmXSnmpUKV1pFdSw=="},"_npmUser":{"name":"vishwam","email":"vishwam@live.com"},"directories":{},"maintainers":[{"name":"bobbybhamra","email":"bobbybhamra-ms@outlook.com"},{"name":"vincenzocaruso","email":"vicaruso@microsoft.com"},{"name":"vishwam","email":"vishwams@microsoft.com"}],"_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/fetch-event-source_2.0.0-alpha.2_1608677087889_0.7856284439192593"},"_hasShrinkwrap":false,"publish_time":1608677088017,"_cnpm_publish_time":1608677088017,"_cnpmcore_publish_time":"2021-12-16T14:41:17.469Z"},"2.0.0-alpha.1":{"name":"@microsoft/fetch-event-source","version":"2.0.0-alpha.1","description":"A better API for making Event Source requests, with all the features of fetch()","homepage":"https://github.com/Azure/fetch-event-source#readme","bugs":{"url":"https://github.com/Azure/fetch-event-source/issues"},"author":{"name":"Microsoft"},"license":"MIT","main":"lib/index.js","types":"lib/index.d.ts","sideEffects":false,"scripts":{"clean":"rimraf ./lib ./coverage","prebuild":"npm run clean","build":"tsc","test":"nyc jasmine --config=jasmine.json","prepublishOnly":"npm run build && npm run test"},"devDependencies":{"@types/jasmine":"^3.5.12","jasmine":"^3.6.1","nyc":"^15.1.0","rimraf":"^3.0.2","source-map-support":"^0.5.19","typescript":"^3.9.7"},"readmeFilename":"README.md","gitHead":"6ff6dd1c45a5b0a174bfc5f50527d7cd585828e7","_id":"@microsoft/fetch-event-source@2.0.0-alpha.1","_nodeVersion":"12.18.3","_npmVersion":"6.14.6","dist":{"shasum":"b18f1c1fdf95feb6dfc41ff780c36ebbb2a31cdb","size":6450,"noattachment":false,"tarball":"https://packages.aliyun.com/604c1a6bf11bae7ca07d6ad3/npm/npm-registry/@microsoft/fetch-event-source/-/fetch-event-source-2.0.0-alpha.1.tgz","integrity":"sha512-viR5O6rbjcUZbYyo3GrOlhSoCXTOAdlUm05/D0vaoI6+YYqVQyaXzxHMX3bl6GESQP4cbzefj9g0Iq75RXLOJQ=="},"_npmUser":{"name":"vishwam","email":"vishwam@live.com"},"directories":{},"maintainers":[{"name":"bobbybhamra","email":"bobbybhamra-ms@outlook.com"},{"name":"vincenzocaruso","email":"vicaruso@microsoft.com"},{"name":"vishwam","email":"vishwams@microsoft.com"}],"_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/fetch-event-source_2.0.0-alpha.1_1608673121407_0.28085256277026316"},"_hasShrinkwrap":false,"publish_time":1608673121540,"_cnpm_publish_time":1608673121540,"_cnpmcore_publish_time":"2021-12-16T14:41:17.729Z"},"1.0.2":{"name":"@microsoft/fetch-event-source","version":"1.0.2","description":"A better API for making Event Source requests, with all the features of fetch()","homepage":"https://github.com/Azure/fetch-event-source#readme","bugs":{"url":"https://github.com/Azure/fetch-event-source/issues"},"author":{"name":"Microsoft"},"license":"MIT","main":"lib/index.js","types":"lib/index.d.ts","sideEffects":false,"scripts":{"clean":"rimraf ./lib ./coverage","prebuild":"npm run clean","build":"tsc","test":"nyc jasmine --config=jasmine.json","prepublishOnly":"npm run build && npm run test"},"devDependencies":{"@types/jasmine":"^3.5.12","jasmine":"^3.6.1","nyc":"^15.1.0","rimraf":"^3.0.2","source-map-support":"^0.5.19","typescript":"^3.9.7"},"gitHead":"6ff6dd1c45a5b0a174bfc5f50527d7cd585828e7","_id":"@microsoft/fetch-event-source@1.0.2","_nodeVersion":"12.18.3","_npmVersion":"6.14.6","dist":{"shasum":"ebab8a75658825fb0ffa6fe0fc3f53b92b888934","size":7369,"noattachment":false,"tarball":"https://packages.aliyun.com/604c1a6bf11bae7ca07d6ad3/npm/npm-registry/@microsoft/fetch-event-source/-/fetch-event-source-1.0.2.tgz","integrity":"sha512-93MoH97PIwZ5pjip/qtQ4XzFnhlbe7ySdLfIM6Oqhe0OZRg2imJSUXbNDxVrnBBkA6wH8WssmUQTRd5bNMjSVw=="},"_npmUser":{"name":"vishwam","email":"vishwam@live.com"},"directories":{},"maintainers":[{"name":"bobbybhamra","email":"bobbybhamra-ms@outlook.com"},{"name":"vincenzocaruso","email":"vicaruso@microsoft.com"},{"name":"vishwam","email":"vishwams@microsoft.com"}],"_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/fetch-event-source_1.0.2_1606510267217_0.09263680535372143"},"_hasShrinkwrap":false,"publish_time":1606510267471,"_cnpm_publish_time":1606510267471,"_cnpmcore_publish_time":"2021-12-16T14:41:17.989Z"},"1.0.1":{"name":"@microsoft/fetch-event-source","version":"1.0.1","description":"A better API for making Event Source requests, with all the features of fetch()","homepage":"https://github.com/Azure/fetch-event-source#readme","bugs":{"url":"https://github.com/Azure/fetch-event-source/issues"},"author":{"name":"Microsoft"},"license":"MIT","main":"lib/index.js","types":"lib/index.d.ts","sideEffects":false,"scripts":{"clean":"rimraf ./lib ./coverage","prebuild":"npm run clean","build":"tsc","test":"nyc jasmine --config=jasmine.json","prepublishOnly":"npm run build && npm run test"},"devDependencies":{"@types/jasmine":"^3.5.12","jasmine":"^3.6.1","nyc":"^15.1.0","rimraf":"^3.0.2","source-map-support":"^0.5.19","typescript":"^3.9.7"},"gitHead":"8d65b5d28f776f44f6068afebd3502e2412ce311","_id":"@microsoft/fetch-event-source@1.0.1","_nodeVersion":"12.18.3","_npmVersion":"6.14.6","dist":{"shasum":"a8f88733f11660341097035672e8f1cfe83da391","size":7226,"noattachment":false,"tarball":"https://packages.aliyun.com/604c1a6bf11bae7ca07d6ad3/npm/npm-registry/@microsoft/fetch-event-source/-/fetch-event-source-1.0.1.tgz","integrity":"sha512-ClD9q8hYRn/g9OdIQj6yYAj7GihlaZXLtlcSMQ88DW1yehFl3CezcbDXUPk6kv/nsLGyyX9891L+jYo0Ho10kA=="},"_npmUser":{"name":"vishwam","email":"vishwam@live.com"},"directories":{},"maintainers":[{"name":"bobbybhamra","email":"bobbybhamra-ms@outlook.com"},{"name":"vincenzocaruso","email":"vicaruso@microsoft.com"},{"name":"vishwam","email":"vishwams@microsoft.com"}],"_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/fetch-event-source_1.0.1_1605728901739_0.5348038370984778"},"_hasShrinkwrap":false,"publish_time":1605728901907,"_cnpm_publish_time":1605728901907,"_cnpmcore_publish_time":"2021-12-16T14:41:18.200Z"},"1.0.0":{"name":"@microsoft/fetch-event-source","version":"1.0.0","description":"A better API for making Event Source requests, with all the features of fetch()","homepage":"https://github.com/Azure/fetch-event-source#readme","bugs":{"url":"https://github.com/Azure/fetch-event-source/issues"},"author":{"name":"Microsoft"},"license":"MIT","main":"lib/index.js","types":"lib/index.d.ts","sideEffects":false,"scripts":{"clean":"rimraf ./lib ./coverage","prebuild":"npm run clean","build":"tsc","test":"nyc jasmine --config=jasmine.json","prepublishOnly":"npm run build && npm run test"},"devDependencies":{"@types/jasmine":"^3.5.12","jasmine":"^3.6.1","nyc":"^15.1.0","rimraf":"^3.0.2","source-map-support":"^0.5.19","typescript":"^3.9.7"},"gitHead":"506bf8d6760bf3837e8d7a390addc8bae54a0881","_id":"@microsoft/fetch-event-source@1.0.0","_nodeVersion":"12.16.1","_npmVersion":"6.14.7","dist":{"shasum":"5b92cdb7309ddff1397cfd6a8f6b0e86beebc4f0","size":7108,"noattachment":false,"tarball":"https://packages.aliyun.com/604c1a6bf11bae7ca07d6ad3/npm/npm-registry/@microsoft/fetch-event-source/-/fetch-event-source-1.0.0.tgz","integrity":"sha512-SV5VBhoRzNvlvP9vIQKLOJ0/JhoqqVzZiE0FamzTHBl3K6Vl98KcJWlv9i3OWfi+ZBj/tkFKXEOIF15SIW14jg=="},"maintainers":[{"name":"bobbybhamra","email":"bobbybhamra-ms@outlook.com"},{"name":"vincenzocaruso","email":"vicaruso@microsoft.com"},{"name":"vishwam","email":"vishwams@microsoft.com"}],"_npmUser":{"name":"microsoft","email":"npmjs@microsoft.com"},"directories":{},"_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/fetch-event-source_1.0.0_1597683602688_0.2628370362069814"},"_hasShrinkwrap":false,"publish_time":1597683602945,"_cnpm_publish_time":1597683602945,"_cnpmcore_publish_time":"2021-12-16T14:41:18.450Z"}},"bugs":{"url":"https://github.com/Azure/fetch-event-source/issues"},"homepage":"https://github.com/Azure/fetch-event-source#readme","repository":{"type":"git","url":"git+https://github.com/Azure/fetch-event-source.git"},"_source_registry_name":"default"}